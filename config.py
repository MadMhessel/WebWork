import os

# === Базовые настройки бота ===
BOT_TOKEN: str = os.getenv("BOT_TOKEN", "").strip()
CHANNEL_ID: str = os.getenv("CHANNEL_ID", "").strip()  # пример: "@my_news_channel" или числовой ID

# === Флаги и режимы ===
ENABLE_REWRITE: bool = os.getenv("ENABLE_REWRITE", "true").lower() in {"1", "true", "yes"}
STRICT_FILTER: bool = os.getenv("STRICT_FILTER", "true").lower() in {"1", "true", "yes"}
ENABLE_MODERATION: bool = os.getenv("ENABLE_MODERATION", "false").lower() in {"1", "true", "yes"}
ADMIN_CHAT_ID: str = os.getenv("ADMIN_CHAT_ID", "").strip()
MODERATOR_IDS = [s.strip() for s in os.getenv("MODERATOR_IDS", "").split(",") if s.strip()]
ALLOW_IMAGES: bool = os.getenv("ALLOW_IMAGES", "true").lower() in {"1", "true", "yes"}  # разрешить обработку изображений
MIN_IMAGE_BYTES: int = int(os.getenv("MIN_IMAGE_BYTES", "10000"))  # минимальный размер файла изображения
IMAGE_TIMEOUT: int = int(os.getenv("IMAGE_TIMEOUT", "15"))  # таймаут загрузки изображений (сек)

LOG_LEVEL: str = os.getenv("LOG_LEVEL", "INFO").upper()

# === Регулируемые параметры фильтра ===
FILTER_HEAD_CHARS: int = int(os.getenv("FILTER_HEAD_CHARS", "400"))
WHITELIST_SOURCES = set(
    s.strip().lower()
    for s in os.getenv("WHITELIST_SOURCES", "").split(",")
    if s.strip()
)
WHITELIST_RELAX: bool = os.getenv("WHITELIST_RELAX", "true").lower() in {"1", "true", "yes"}
FETCH_LIMIT_PER_SOURCE: int = int(os.getenv("FETCH_LIMIT_PER_SOURCE", "30"))
LOOP_DELAY_SECS: int = int(os.getenv("LOOP_DELAY_SECS", "600"))

# === Ключевые слова ===
REGION_KEYWORDS = [
    # --- Область: формы и синонимы ---
    "нижегородская область",
    "нижегородской области",
    "в нижегородской области",
    "на территории нижегородской области",
    "по нижегородской области",
    "нижегородская обл.",
    "нижегородской обл.",
    "в нижегородской обл.",
    "нижегородье",
    "нижегородск",  # стем для «нижегородский/–ая/–ом» (район, предприятия и т.п.)

    # --- Нижний Новгород (город) ---
    "нижний новгород",
    "нижнего новгорода",
    "в нижнем новгороде",
    "г. нижний новгород",
    "город нижний новгород",
    "н. новгород",
    "н.новгород",
    "н новгород",
    "нн",  # часто встречается как сокращение в лок-СМИ

    # --- Районы города Нижнего Новгорода ---
    "автозаводский район", "в автозаводском районе",
    "сормовский район", "в сормовском районе",
    "канавинский район", "в канавинском районе",
    "нижегородский район", "в нижегородском районе",
    "московский район", "в московском районе",
    "ленинский район", "в ленинском районе",
    "приокский район", "в приокском районе",
    "советский район", "в советском районе",

    # --- Крупные города/округа области (безопасные стемы/формы) ---
    "дзержинск", "в дзержинске", "дзержинска",
    "арзамас", "в арзамасе", "арзамаса",
    "саров", "в сарове", "сарова",
    "выкса", "в выксе", "выксе", "выксунский",
    "кстово", "в кстове", "кстовский", "кстовском",
    "павлово", "в павлове", "павловский",
    "павлово-на-оке", "в павлово-на-оке",
    "балахна", "в балахне", "балахнинский", "балахнинском",
    "богородск", "в богородске", "богородский",
    "городец", "в городеце", "городецкий",
    "лысково", "в лыскове", "лысковский",
    "семёнов", "семенов", "в семёнове", "в семенове", "семёновский", "семеновский",
    "княгинино", "в княгинине", "княгининский",
    "кулебаки", "в кулебаках", "кулебакский",
    "навашино", "в навашино", "навашинский",
    "перевоз (город)", "город перевоз", "в городе перевоз",
    "первомайск", "в первомайске", "первомайский (город)",
    "сергач", "в сергаче", "сергачский",
    "урень", "в урене", "уренский",
    "шахунья", "в шахунье", "шахунский",
    "ветлуга", "в ветлуге", "ветлужский",
    "лукоянов", "в лукоянове", "лукояновский",
    "володарск", "в володарске", "володарский",
    "чкаловск", "в чкаловске", "чкаловский",
    # «бор» — только безопасные варианты (во избежание ложных «оборудование/выборы»)
    "г. бор", "город бор", "в бору", "на бору", "бор (нижегородская область)", "бор нижегородской области",
    # «заволжье» — безопасные варианты (слово часто употребляется как геотермин)
    "г. заволжье", "город заволжье", "заволжье (город)", "заволжье нижегородской области",

    # --- Муниципальные районы/округа области (названия + формы «район/в районе») ---
    "ардатовский район", "в ардатовском районе", "ардатово",
    "большеболдинский район", "в большеболдинском районе", "большое болдино",
    "большемурашкинский район", "в большемурашкинском районе", "большое мурашкино",
    "бутурлинский район", "в бутурлинском районе", "бутурлино",
    "вачский район", "в вачском районе", "вача",
    "варнавинский район", "в варнавинском районе", "варнавино",
    "воскресенский район", "в воскресенском районе", "воскресенское (нн)",
    "воротынский район", "в воротынском районе", "воротынец",
    "выксунский район", "в выксунском районе",  # для старых упоминаний
    "гагинский район", "в гагинском районе", "гагино",
    "городецкий район", "в городецком районе",
    "дивеевский район", "в дивеевском районе", "дивеево",
    "княгининский район", "в княгининском районе",
    "ковернинский район", "в ковернинском районе", "ковернино",
    "краснобаковский район", "в краснобаковском районе", "красные баки",
    "кулебакский район", "в кулебакском районе",
    "лукояновский район", "в лукояновском районе",
    "лысковский район", "в лысковском районе",
    "павловский район", "в павловском районе",
    "перевозский район", "в перевозском районе",
    "первомайский район", "в первомайском районе",
    "пильнинский район", "в пильнинском районе", "пильна",
    "починковский район", "в починковском районе", "починки",
    "сеченовский район", "в сеченовском районе", "сеченово",
    "сергачский район", "в сергачском районе",
    "сосновский район", "в сосновском районе", "сосновское (нн)",
    "спасский район", "в спасском районе", "спасское (нн)",
    "тонкинский район", "в тонкинском районе", "тонкино",
    "тоншаевский район", "в тоншаевском районе", "тоншаево",
    "уренский район", "в уренском районе",
    "шаранский район", "в шаранском районе", "шаранга",
    "шатковский район", "в шатковском районе", "шатки",
    "балахнинский район", "в балахнинском районе",
    "богородский район", "в богородском районе",
    "кстовский район", "в кстовском районе",
    "володарский район", "в володарском районе",
    "чкаловский округ", "в чкаловском округе",
    "шахунский округ", "в шахунском округе",
    "навашинский округ", "в навашинском округе",
]

CONSTRUCTION_KEYWORDS = [
    # --- Базовые стемы по стройке/СМР/вводу ---
    "строител",                 # строить, строительство, строительные, строительный
    "стройработ",               # стройработы
    "смр",                      # строительно-монтажные работы
    "строительно-монтажн",
    "возведен", "возведут", "возводят", "возведение",
    "построят", "построен", "построили", "построить",
    "ввод в эксплуатац", "ввели в эксплуатац", "ввод объекта", "ввести в эксплуатац",
    "разрешение на стро", "разрешение на ввод",
    "госкомисси", "приемка объекта", "акт ввода",

    # --- Реконструкция/капремонт/снос/благоустройство ---
    "реконструкц",              # реконструкция, реконструируют, реконструирован
    "капремонт", "капитальный ремонт",
    "снос", "демонтаж",
    "благоустройст", "благоустро", "реновац", "крт",  # комплексное развитие территорий

    # --- Девелопмент/застройщик/подряд ---
    "девелопер", "девелопмент",
    "застройщик", "застройк",   # застройка территории
    "генподряд", "подрядчик", "подрядн", "субподряд",
    "техзаказчик", "заказчик строительства",
    "проектная документац", "экспертиза проектной документац", "госэкспертиз",

    # --- Жильё/объекты недвижимости (аккуратно, без короткого «жк») ---
    "жилой комплекс", "многоквартирн", "многоэтажн", "домостроен",
    "инфраструктурный объект", "объект строительства", "объект капитального строительства", "окск",

    # --- Инженерные сети и объекты ---
    "инженерн сет", "инженерн инфраструктур",
    "водопровод", "канализац", "ливнев", "водоотведен",
    "теплосет", "котельн", "теплоисточн", "теплотрасс",
    "газопровод", "грп", "грсу",
    "лэп", "подстанц", "электросет", "кабельн лини",
    "очистные сооружен", "кнс", "нвк", "водозаборн сооружен", "насосн станц", "резервуар чистой воды",

    # --- Транспорт/дороги/мосты/метро ---
    "дорожные работы", "дорожн работ",
    "ремонт дороги", "капитальный ремонт дороги", "реконструкция дороги",
    "транспортная развязк", "развязк", "эстакад", "путепровод", "тоннел",
    "мост", "ремонт моста", "строительство моста",
    "трамвайная лини", "трамвайное полотно", "контактн сеть",
    "метро", "станция метро", "электродепо",

    # --- Соцобъекты (только с явным строительным контекстом) ---
    "строительство школы", "строительство детского сада",
    "строительство поликлиники", "строительство больницы",
    "строительство фока", "строительство спорткомплекса",
    "строительство стадиона", "строительство дворца спорта",
    "строительство ледового", "строительство бассейна",

    # --- Урбанистика/градрегламенты/планировка ---
    "генплан", "градплан", "градостроительн план", "гпзу",
    "проект планировки территор", "ппт",
    "правила землепользования и застройки", "пзз",
    "межеван", "редевелопмент", "реорганизац территор",

    # --- Программы и формулировки из пресс-релизов ---
    "нацпроект", "федеральная программ", "региональная программ",
    "комплексное освоение территор", "общественно-деловая застройк",
    "инвестиционный проект", "инфраструктурный проект", "гчп", "концесс",
]

# === Источники ===
# Примечание:
#  - type="rss" — обычный RSS;
#  - type="html" — одна статья по URL;
#  - type="html_list" — страница-лента с карточками; "selectors" все опциональны.
SOURCES = [
    # === ОФИЦИАЛЬНЫЕ (RSS) — остаются как есть ===
    {"name": "Минград НО — пресс-центр",      "type": "rss", "url": "https://mingrad.nobl.ru/presscenter/news/rss/"},
    {"name": "Госстройнадзор НО — пресс-центр","type": "rss", "url": "https://nngosnadzor.nobl.ru/presscenter/news/rss/"},
    {"name": "Минтранс НО — пресс-центр",     "type": "rss", "url": "https://mintrans.nobl.ru/presscenter/news/rss/"},
    {"name": "г.о. Бор — пресс-центр",        "type": "rss", "url": "https://bor.nobl.ru/presscenter/news/rss/"},
    {"name": "Арзамас — пресс-центр",         "type": "rss", "url": "https://arzamas.nobl.ru/presscenter/news/rss/"},
    {"name": "Кстовский округ — пресс-центр", "type": "rss", "url": "https://kstovo.nobl.ru/presscenter/news/rss/"},
    {"name": "Павлово — пресс-центр",         "type": "rss", "url": "https://pavlovo.nobl.ru/presscenter/news/rss/"},
    {"name": "Гордума Нижнего Новгорода",     "type": "rss", "url": "https://www.duma.nnov.ru/rss"},
    {"name": "ИА «Время Н»",                  "type": "rss", "url": "https://www.vremyan.ru/rss/news.rss"},

    # === HTML-ЛИСТИНГИ (новые) ===
    # Администрация Нижнего Новгорода — раздел «Строительство»
    {"name": "Администрация НН — Строительство", "type": "html_list",
     "url": "https://admnnov.ru/?id=48",
     "selectors": {
        "item": "article, .news-item, .entry, .post, li",
        "link": "a",
        "title": "h1 a, h2 a, h3 a, h2, h3, a",
        "date": "time, .date, .news-date, .posted-on",
        "date_attr": "datetime"
     }},

    # Правительство НО — лента «Все новости»
    {"name": "Правительство НО — Новости", "type": "html_list",
     "url": "https://nobl.ru/news/",
     "selectors": {
        "item": "article, .news__item, .card, li",
        "link": "a",
        "title": "h2 a, h3 a, h2, h3, a",
        "date": "time, .date, .news-date",
        "date_attr": "datetime"
     }},

    # NewsNN — тег «Строительство»
    {"name": "NewsNN — Строительство", "type": "html_list",
     "url": "https://www.newsnn.ru/tags/stroitelstvo",
     "selectors": {
        "item": "article, .card, .news-item, li",
        "link": "a",
        "title": "h2 a, h3 a, h2, h3, a",
        "date": "time, .date",
        "date_attr": "datetime"
     }},

    # Newsroom24 — основная лента
    {"name": "Newsroom24 — Новости", "type": "html_list",
     "url": "https://newsroom24.ru/news/",
     "selectors": {
        "item": "article, .news, .news-item, .card, li",
        "link": "a",
        "title": "h2 a, h3 a, h2, h3, a",
        "date": "time, .date",
        "date_attr": "datetime"
     }},

    # Говорит Нижний — главная/новости
    {"name": "Говорит Нижний — Новости", "type": "html_list",
     "url": "https://govoritnn.ru/",
     "selectors": {
        "item": "article, .post, .entry, .card, .news, li",
        "link": "a",
        "title": "h2 a, h3 a, h2, h3, a",
        "date": "time, .date, .posted-on",
        "date_attr": "datetime"
     }},

    # НТА-Приволжье — главная/новости
    {"name": "НТА-Приволжье — Новости", "type": "html_list",
     "url": "https://www.nta-nn.ru/",
     "selectors": {
        "item": "article, .news-item, .news, .card, li",
        "link": "a",
        "title": "h2 a, h3 a, h2, h3, a",
        "date": "time, .date, .news-date",
        "date_attr": "datetime"
     }},

    # GIPERNN — Журнал/Жилье/Новости
    {"name": "GIPERNN — Жилье/Новости", "type": "html_list",
     "url": "https://www.gipernn.ru/zhurnal/zhile/novosti",
     "selectors": {
        "item": "article, .article, .news-item, .card, li",
        "link": "a",
        "title": "h2 a, h3 a, h2, h3, a",
        "date": "time, .date",
        "date_attr": "datetime"
     }},

    # Столица Нижний — медиа-портал
    {"name": "Столица Нижний (STN Media)", "type": "html_list",
     "url": "https://stnmedia.ru/",
     "selectors": {
        "item": "article, .news-item, .card, li",
        "link": "a",
        "title": "h2 a, h3 a, h2, h3, a",
        "date": "time, .date",
        "date_attr": "datetime"
     }},

    # STN REALTY — LIVE
    {"name": "STN REALTY — LIVE", "type": "html_list",
     "url": "https://stn-realty.ru/live/",
     "selectors": {
        "item": "article, .news-item, .card, li",
        "link": "a",
        "title": "h2 a, h3 a, h2, h3, a",
        "date": "time, .date, .posted-on",
        "date_attr": "datetime"
     }},

    # В городе N — новости
    {"name": "В городе N — Новости", "type": "html_list",
     "url": "https://vgoroden.ru/news/",
     "selectors": {
        "item": "article, .news-item, .news, .card, li",
        "link": "a",
        "title": "h2 a, h3 a, h2, h3, a",
        "date": "time, .date",
        "date_attr": "datetime"
     }},

    # NN.RU — Новости
    {"name": "NN.RU — Новости", "type": "html_list",
     "url": "https://www.nn.ru/news/",
     "selectors": {
        "item": "article, .news, .card, li",
        "link": "a",
        "title": "h2 a, h3 a, h2, h3, a",
        "date": "time, .date, .news-date",
        "date_attr": "datetime"
     }},

    # NN.RU — Недвижимость
    {"name": "NN.RU — Недвижимость", "type": "html_list",
     "url": "https://www.nn.ru/realty/",
     "selectors": {
        "item": "article, .news, .card, li",
        "link": "a",
        "title": "h2 a, h3 a, h2, h3, a",
        "date": "time, .date, .news-date",
        "date_attr": "datetime"
     }},

    # Домострой-НН — Новости
    {"name": "Домострой-НН — Новости", "type": "html_list",
     "url": "https://www.domostroynn.ru/novosti",
     "selectors": {
        "item": "article, .news-item, .card, li",
        "link": "a",
        "title": "h2 a, h3 a, h2, h3, a",
        "date": "time, .date",
        "date_attr": "datetime"
     }},
]

# === Хранилище ===
DB_PATH: str = os.getenv("DB_PATH", "newsbot.db")

# === Telegram ===
TELEGRAM_PARSE_MODE: str = os.getenv("TELEGRAM_PARSE_MODE", "HTML").strip()
TELEGRAM_DISABLE_WEB_PAGE_PREVIEW: bool = os.getenv("TELEGRAM_DISABLE_WEB_PAGE_PREVIEW", "true").lower() in {"1", "true", "yes"}
TELEGRAM_MESSAGE_LIMIT: int = int(os.getenv("TELEGRAM_MESSAGE_LIMIT", "4096"))
ON_SEND_ERROR: str = os.getenv("ON_SEND_ERROR", "retry").strip().lower()
PUBLISH_MAX_RETRIES: int = int(os.getenv("PUBLISH_MAX_RETRIES", "2"))
RETRY_BACKOFF_SECONDS: float = float(os.getenv("RETRY_BACKOFF_SECONDS", "2.5"))
PUBLISH_SLEEP_BETWEEN_SEC: float = float(os.getenv("PUBLISH_SLEEP_BETWEEN_SEC", "0"))

# === Рерайт (опц.) ===
REWRITE_MAX_CHARS = int(os.getenv("REWRITE_MAX_CHARS", "900"))
EXTERNAL_AI_ENABLED = os.getenv("EXTERNAL_AI_ENABLED", "false").lower() in {"1", "true", "yes"}
EXTERNAL_AI_ENDPOINT = os.getenv("EXTERNAL_AI_ENDPOINT", "")
EXTERNAL_AI_KEY = os.getenv("EXTERNAL_AI_KEY", "")

# === Кластеризация похожих заголовков (опц.) ===
ENABLE_TITLE_CLUSTERING = os.getenv("ENABLE_TITLE_CLUSTERING", "false").lower() in {"1", "true", "yes"}
CLUSTER_SIM_THRESHOLD = float(os.getenv("CLUSTER_SIM_THRESHOLD", "0.8"))
CLUSTER_LOOKBACK_DAYS = int(os.getenv("CLUSTER_LOOKBACK_DAYS", "14"))
CLUSTER_CANDIDATES = int(os.getenv("CLUSTER_CANDIDATES", "200"))

# === Опрос источников ===
POLL_INTERVAL_SECONDS = int(os.getenv("POLL_INTERVAL_SECONDS", "600"))
FETCH_LIMIT_PER_SOURCE = int(os.getenv("FETCH_LIMIT_PER_SOURCE", "30"))
